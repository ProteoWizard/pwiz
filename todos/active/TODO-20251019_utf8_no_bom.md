# TODO-20251019_utf8_no_bom.md

## Branch Information
- **Branch**: `Skyline/work/20251019_utf8_no_bom`
- **Created**: 2025-10-19
- **Objective**: Standardize all source files to UTF-8 without BOM

## Background
Modern best practice is **UTF-8 without BOM** for source code. BOM can cause issues with:
- Unix/Linux build tools
- Git diffs and merges  
- Some compilers and parsers
- Cross-platform compatibility

The pwiz codebase currently has a mix of files with and without BOM (estimated < 5-25% have BOM, primarily `.cs` files).

## Task Checklist

### Phase 1: Analysis
- [ ] Run `analyze-bom-git.ps1` to get current statistics
- [ ] Review `files-with-bom.txt` for complete file list
- [ ] Identify any files that MUST keep BOM (if any)
- [ ] Document current state in this TODO

### Phase 2: Tooling
- [ ] Create `remove-bom.ps1` script to strip BOM from files
  - Preserve file timestamps where possible
  - Handle files in use gracefully
  - Validate conversion success
  - Support dry-run mode for testing
- [ ] Test script on small subset of files
- [ ] Verify Git diff shows only BOM removal (no content changes)

### Phase 3: Conversion
- [ ] Create test branch and convert subset of files
- [ ] Build and run tests to verify no regressions
- [ ] Visual Studio verification - files open correctly
- [ ] Convert all remaining files
- [ ] Run full test suite on all platforms

### Phase 4: Prevention
- [ ] Add UTF-8 without BOM guideline to STYLEGUIDE.md
- [ ] Document Visual Studio configuration for new files
- [ ] Consider pre-commit hook to prevent BOM reintroduction
- [ ] Update this TODO with final statistics

### Phase 5: Cleanup
- [ ] Remove TODO file before merging to master
- [ ] Keep `analyze-bom-git.ps1` for future verification

## Tools & Scripts
- **`analyze-bom-git.ps1`** - Existing script in project root for analysis
- **`remove-bom.ps1`** - To be created for conversion
- **`files-with-bom.txt`** - Generated by analysis script

## Risks & Considerations
- **Large commit**: May affect hundreds of files
- **Merge conflicts**: Active branches will need coordination
- **Third-party tools**: Some Windows tools default to UTF-8 with BOM
- **Localization**: Verify `.resx` files handle encoding correctly
- **Timing**: Coordinate with team to minimize disruption

## Success Criteria
- All source files standardized to UTF-8 without BOM
- No build or test failures
- Guidelines prevent regression
- Analysis script confirms BOM-free status

## Handoff Prompt for Branch Creation

```
I want to start work on UTF-8 BOM standardization.

Please:
1. Create branch: Skyline/work/YYYYMMDD_utf8_no_bom (use today's date)
2. Rename TODO-utf8_no_bom.md to TODO-YYYYMMDD_utf8_no_bom.md
3. Run .\analyze-bom-git.ps1 and update the TODO with current statistics
4. Begin Phase 1: Analysis

The TODO file contains full context. Let's start by understanding the current state of BOM usage.
```