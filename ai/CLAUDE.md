# Claude Code Configuration for ProteoWizard/Skyline

This file contains critical information for Claude Code sessions working on this codebase.

## PowerShell Script Execution

### CRITICAL: Use `pwsh`, Never `powershell`

This project requires **PowerShell 7** (`pwsh`), not Windows PowerShell 5.1 (`powershell`).

```bash
# WRONG - Windows PowerShell 5.1
powershell -File .\script.ps1

# CORRECT - PowerShell 7
pwsh -Command "& './path/to/script.ps1'"
```

### CRITICAL: Script Path Syntax

The Bash tool in Claude Code does NOT correctly handle Windows-style paths with backslashes. Direct invocation fails:

```bash
# WRONG - Path gets mangled to ".pwiz_toolsSkylineaiBuild-Skyline.ps1"
.\pwiz_tools\Skyline\ai\Build-Skyline.ps1

# WRONG - Same problem with -File parameter
pwsh -File .\pwiz_tools\Skyline\ai\Build-Skyline.ps1
```

**Always use this pattern:**

```bash
# CORRECT - Use -Command with quoted path and call operator
pwsh -Command "& './pwiz_tools/Skyline/ai/Build-Skyline.ps1'"

# CORRECT - With arguments
pwsh -Command "& './pwiz_tools/Skyline/ai/Build-Skyline.ps1' -RunTests -TestName CodeInspection"

# CORRECT - Run-Tests.ps1 with arguments
pwsh -Command "& './pwiz_tools/Skyline/ai/Run-Tests.ps1' -TestName TestPanoramaDownloadFile"
```

### Why This Works

1. `pwsh -Command` executes PowerShell commands directly
2. The `&` (call operator) invokes the script
3. Forward slashes (`/`) work in PowerShell and don't get mangled
4. Single quotes inside double quotes preserve the path as a single argument

## Common Build and Test Commands

```bash
# Full solution build
pwsh -Command "& './pwiz_tools/Skyline/ai/Build-Skyline.ps1'"

# Build with tests
pwsh -Command "& './pwiz_tools/Skyline/ai/Build-Skyline.ps1' -RunTests"

# Build specific target
pwsh -Command "& './pwiz_tools/Skyline/ai/Build-Skyline.ps1' -Target TestConnected"

# Run specific test
pwsh -Command "& './pwiz_tools/Skyline/ai/Run-Tests.ps1' -TestName TestPanoramaDownloadFile"

# Run test with internet access
pwsh -Command "& './pwiz_tools/Skyline/ai/Run-Tests.ps1' -TestName TestPanoramaDownloadFile -Internet"

# Run test with visible UI
pwsh -Command "& './pwiz_tools/Skyline/ai/Run-Tests.ps1' -TestName TestSomeUITest -ShowUI"
```

## CRITICAL: File Editing on Windows

### MANDATORY: Always Use Backslashes for File Paths in Edit Tools

**When using Edit or MultiEdit tools on Windows, you MUST use backslashes (`\`) in file paths, NOT forward slashes (`/`).**

```
# WRONG - Will cause errors
Edit(file_path: "C:/proj/pwiz/pwiz_tools/Skyline/SomeFile.cs", ...)

# CORRECT - Always works
Edit(file_path: "C:\proj\pwiz\pwiz_tools\Skyline\SomeFile.cs", ...)
```

This applies to:
- `Edit` tool
- `MultiEdit` tool
- `Write` tool
- `Read` tool

**Note**: This is the opposite of PowerShell script paths (which need forward slashes in the Bash tool). The distinction:
- **Bash tool with pwsh**: Use forward slashes in the quoted path string
- **Edit/Write/Read tools**: Use backslashes (Windows native paths)

## Documentation Discovery

**Unsure what documentation exists?** Consult **[ai/TOC.md](TOC.md)** - a comprehensive table of contents with:
- All 58 documents (core files, guides, skills, commands)
- One-line descriptions of each
- Size metrics (line/character counts)

This TOC is auto-generated by `ai/scripts/Generate-TOC.ps1` and updated during weekly syncs.

## Essential Documentation

Before writing code, read these files:

1. **ai/CRITICAL-RULES.md** - Absolute constraints (NO async/await, resource strings, etc.)
2. **ai/MEMORY.md** - Project context and gotchas
3. **ai/docs/build-and-test-guide.md** - Detailed build and test instructions

## Skills

Load the `skyline-development` skill for comprehensive project context:
- Provides access to all documentation
- Explains TODO workflow
- Contains testing patterns
