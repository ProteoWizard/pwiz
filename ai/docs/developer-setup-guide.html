<html>
<body>
<h1>AI-Assisted IDE Setup for Skyline Developers</h1>

<p>These instructions help Skyline developers configure their Windows workstation so LLM-assisted IDEs (Cursor, VS Code + Copilot/Claude, etc.) can build, test, and inspect Skyline autonomously. Perform these steps <i>after</i> cloning <code>pwiz</code> and completing the <a href="wiki-page.view?name=HowToBuildSkylineTip">standard setup</a>.</p>

<h3>Quick Checklist</h3>
<ol>
<li>Install PowerShell 7 (UTF-8 terminal support)</li>
<li>Configure PowerShell 7 profile for permanent UTF-8 encoding</li>
<li>Update Cursor/VS Code terminal settings to use PowerShell 7 + UTF-8</li>
<li>Install Claude Code CLI for agentic coding workflows</li>
<li>Install ReSharper command-line tools (<code>jb inspectcode</code>)</li>
<li>Install GitHub CLI (<code>gh</code>) for agentic PR workflows</li>
<li>Install LabKey MCP server (skyline.ms data access)</li>
<li>Configure Git and global line ending settings</li>
<li>Install a Markdown viewer for browser-based docs</li>
<li>Optional: Install additional helpers (Everything Search, Diff tools)</li>
<li><strong>Verify setup</strong>: <code>pwsh -File ai\scripts\Verify-Environment.ps1</code></li>
</ol>

<h2>Using an LLM to Automate Setup</h2>

<p>Much of this workstation prep can be delegated to an AI assistant. In Claude Code, simply run:</p>
<pre>/pw-configure</pre>

<p>Alternatively, run the verification script directly to see current status:</p>
<pre>pwsh -File ai\scripts\Verify-Environment.ps1</pre>

<p>For other AI assistants (Cursor, Copilot Chat, etc.), paste this prompt:</p>
<pre>You are configuring a Skyline development workstation for LLM-assisted IDE workflows.
Work inside the pwiz repository at C:\proj\pwiz.
First run: pwsh -File ai\scripts\Verify-Environment.ps1
Then help fix any [MISSING] items shown in the output.
Call out any steps that require human action (Visual Studio workloads, browser extensions, antivirus exclusions).</pre>

<h2>1. Terminal Environment (UTF-8, PowerShell 7)</h2>

<p>LLM tooling expects UTF-8 output. Windows PowerShell 5.1 defaults to CP1252 and corrupts emoji/status icons.</p>

<h3>Install PowerShell 7</h3>
<pre>winget install Microsoft.PowerShell</pre>
<p>Restart Cursor/VS Code after install.</p>

<h3>Configure Permanent UTF-8 Encoding</h3>
<p>PowerShell 7 may still default to OEM US (CP437) for console output. Configure your profile to permanently set UTF-8:</p>
<ol>
<li>Open your PowerShell 7 profile for editing:<br><code>notepad $PROFILE</code></li>
<li>If the file doesn't exist, create it first:<br><code>New-Item -Path $PROFILE -ItemType File -Force</code></li>
<li>Add these lines to the profile:
<pre># Set UTF-8 encoding for console output and pipeline
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
$OutputEncoding = [System.Text.Encoding]::UTF8</pre></li>
<li>Save and close notepad, then reload the profile:<br><code>. $PROFILE</code></li>
</ol>

<h3>Verify Installation</h3>
<pre>$PSVersionTable.PSVersion      # Should show 7.x
[Console]::OutputEncoding      # Should show: BodyName: utf-8, CodePage: 65001</pre>

<h3>Cursor / VS Code settings</h3>
<p>Add to <code>.vscode/settings.json</code> (already checked-in in this repo):</p>
<pre>{
  "terminal.integrated.defaultProfile.windows": "PowerShell",
  "terminal.integrated.env.windows": {
    "LANG": "en_US.UTF-8",
    "LC_ALL": "en_US.UTF-8"
  }
}</pre>

<h2>2. Required Command-Line Tools</h2>

<h3>Claude Code CLI</h3>
<p>Claude Code is Anthropic's agentic coding tool that runs in the terminal. It understands your codebase and can execute commands, edit files, and handle git workflows through natural language.</p>

<p><strong>Install (run in PowerShell 7 as Administrator):</strong></p>
<pre>irm https://claude.ai/install.ps1 | iex</pre>

<p><strong>Known Issue: PATH not updated</strong></p>
<p>The installer may not add Claude Code to your PATH. If <code>claude</code> is not recognized after installation, add it manually:</p>
<pre># Add to user PATH permanently
$claudePath = "$env:USERPROFILE\.local\bin"
[Environment]::SetEnvironmentVariable("Path", [Environment]::GetEnvironmentVariable("Path", "User") + ";$claudePath", "User")

# Refresh current session's PATH
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")</pre>

<p><strong>Verify:</strong></p>
<pre>claude --version</pre>

<p><strong>Authenticate:</strong> After installation, run <code>claude</code> and follow the prompts to authenticate with your Anthropic account (requires Claude Pro, Max, or Team subscription, or API key).</p>

<p><strong>VS Code Extension:</strong> Claude Code also has a VS Code extension that provides a visual interface. Install from the VS Code marketplace: search for "Claude Code" by Anthropic.</p>

<h3>ReSharper Command-Line Tools (inspectcode)</h3>
<p>Needed for pre-commit validation (<code>Build-Skyline.ps1 -RunInspection</code> / <code>-QuickInspection</code>):</p>
<pre>dotnet tool install -g JetBrains.ReSharper.GlobalTools</pre>

<p><strong>Verify:</strong></p>
<pre>jb --version
jb tool list</pre>

<h3>dotCover Command-Line Tools (code coverage)</h3>
<p>Needed for code coverage analysis (<code>Run-Tests.ps1 -Coverage</code>):</p>
<pre>dotnet tool install --global JetBrains.dotCover.CommandLineTools --version 2025.1.7</pre>

<p><strong>Verify:</strong></p>
<pre>dotCover --version</pre>

<p><strong>Important:</strong> Use version 2025.1.7 or earlier. dotCover 2025.3.0+ has a known bug with JSON export that causes "Object reference not set to an instance of an object" errors.</p>

<h3>GitHub CLI (gh)</h3>
<p>The GitHub CLI enables AI agents to review PRs, fetch issue details, and check CI status directly from the IDE terminal.</p>

<p><strong>Install:</strong></p>
<pre>winget install GitHub.cli --accept-source-agreements --accept-package-agreements</pre>

<p><strong>Authenticate (must run in interactive PowerShell 7 terminal outside VS Code/Cursor):</strong></p>
<pre>gh auth login</pre>

<p>Follow the interactive prompts:</p>
<ol>
<li>Select <strong>GitHub.com</strong> as the account</li>
<li>Select <strong>SSH</strong> as your preferred protocol for Git operations</li>
<li>Answer <strong>No</strong> to generating a new SSH key (you should already have SSH configured via Git/TortoiseGit)</li>
<li>Select <strong>Login with a web browser</strong></li>
<li>Copy the one-time code displayed, then press Enter to open the browser</li>
<li>In the browser, click <strong>Continue</strong> to sign in with your active GitHub account</li>
<li>Paste the one-time code (Ctrl+V) and click <strong>Continue</strong></li>
<li>Click <strong>Continue</strong> again if asked</li>
<li>Click <strong>Authorize github</strong></li>
<li>Complete your 2FA (authenticator app, security key, etc.)</li>
<li>Browser shows "Congratulations, you're all set!"</li>
</ol>

<p><strong>Verify:</strong></p>
<pre>gh auth status
gh pr view 3700   # Test with any open PR</pre>

<p><strong>Note:</strong> The <code>gh auth login</code> command requires an interactive terminal and will not work inside an AI agent's shell context.</p>

<h3>LabKey MCP Server (skyline.ms data access)</h3>
<p>The LabKey MCP server enables Claude Code to query data from skyline.ms directly, including exception reports and nightly test results.</p>

<p><strong>Prerequisites:</strong> Python 3.10+, skyline.ms account with appropriate permissions</p>

<p><strong>Install Python dependencies:</strong></p>
<pre>pip install mcp labkey</pre>

<p><strong>Configure credentials:</strong> Create a netrc file at <code>C:\Users\&lt;YourName&gt;\.netrc</code>:</p>
<pre>machine skyline.ms
login claude.c.skyline@gmail.com
password &lt;password&gt;</pre>

<p><strong>Important:</strong> Use the shared Claude agent account (<code>claude.c.skyline@gmail.com</code>), <strong>not</strong> your personal skyline.ms login. Request the password from team leads via LastPass.</p>

<p><strong>Register MCP server with Claude Code:</strong></p>
<pre>claude mcp add labkey -- python &lt;repo-root&gt;/pwiz_tools/Skyline/Executables/DevTools/LabKeyMcp/server.py</pre>

<p><strong>Verify setup:</strong></p>
<pre>python &lt;repo-root&gt;/pwiz_tools/Skyline/Executables/DevTools/LabKeyMcp/test_connection.py</pre>

<h3>Git Configuration (line endings)</h3>
<p>Skyline requires CRLF on Windows. Configure once globally:</p>
<pre>git config --global core.autocrlf true
git config --global pull.rebase false</pre>

<h2>3. IDE Extensions & Settings</h2>

<h3>Cursor / VS Code</h3>
<ul>
<li>Install extensions: C# Dev Kit (or official C# extension), PowerShell, Claude Code, Markdown All in One</li>
<li>Enable EditorConfig support (<code>"editorconfig.enable": true</code>)</li>
<li>Optional: <strong>Markdown Viewer</strong> browser extension (Chrome/Edge) for external viewing of <code>ai/</code> docs</li>
</ul>

<h3>Visual Studio 2022</h3>
<ul>
<li>Install ReSharper Ultimate (IDE integration)</li>
<li>Ensure <strong>.NET Desktop Development</strong> and <strong>Desktop Development with C++</strong> workloads are installed</li>
<li>Run <code>quickbuild.bat</code> once to pull vendor SDKs</li>
</ul>

<h2>4. Environment Validation</h2>

<h3>Quick Check: Verify Prerequisites</h3>
<p>Run the environment verification script to check all prerequisites at once:</p>
<pre>pwsh -File C:\proj\pwiz\ai\scripts\Verify-Environment.ps1</pre>

<p>This checks: PowerShell 7, UTF-8 encoding, Claude Code CLI, ReSharper CLI, dotCover, GitHub CLI, Python packages, LabKey MCP server, netrc credentials, and Git configuration.</p>

<p>Example output:</p>
<pre>========================================
Environment Check Results
========================================

  PowerShell                    [OK]      7.5.4
  Console Encoding              [OK]      UTF-8 (CP65001)
  Claude Code CLI               [OK]      2.0.69
  ReSharper CLI (jb)            [OK]      2025.2.4
  dotCover CLI                  [OK]      2025.1.7
  GitHub CLI (gh)               [OK]      2.83.1
  GitHub CLI Auth               [OK]      authenticated
  Python                        [OK]      3.13.6
  Python packages (labkey, mcp) [OK]      installed
  netrc credentials             [OK]      .netrc exists
  LabKey MCP Server             [OK]      registered and connected
  Git core.autocrlf             [OK]      true
  Git pull.rebase               [OK]      false

----------------------------------------
  OK: 13 | Warnings: 0 | Missing: 0 | Errors: 0

[OK] Environment is fully configured for LLM-assisted development</pre>

<p>Any <code>[MISSING]</code> items will show the command needed to fix them.</p>

<h3>Full Validation: Build and Test</h3>
<p>After prerequisites pass, validate the build toolchain:</p>
<pre>cd C:\proj\pwiz\pwiz_tools\Skyline
.\ai\Build-Skyline.ps1 -RunTests -QuickInspection
.\ai\Build-Skyline.ps1 -RunInspection         # Full validation (~20-25 min)
.\ai\Run-Tests.ps1 -TestName CodeInspection</pre>

<p>All commands should report <strong>[OK]</strong>. Resolve any <strong>[FAILED]</strong> messages before committing.</p>

<h2>5. Common Issues & Fixes</h2>

<table border="1" cellpadding="5" cellspacing="0">
<tr><th>Symptom</th><th>Cause</th><th>Fix</th></tr>
<tr><td>Emoji/Unicode renders as <code>a...</code></td><td>Terminal using CP1252/CP437</td><td>Install PowerShell 7, add UTF-8 config to <code>$PROFILE</code></td></tr>
<tr><td><code>claude</code> not found after install</td><td>PATH not updated by installer</td><td>Add <code>$env:USERPROFILE\.local\bin</code> to PATH</td></tr>
<tr><td><code>jb</code> not found</td><td>ReSharper CLI missing</td><td><code>dotnet tool install -g JetBrains.ReSharper.GlobalTools</code></td></tr>
<tr><td><code>dotCover</code> not found</td><td>dotCover CLI missing</td><td><code>dotnet tool install --global JetBrains.dotCover.CommandLineTools --version 2025.1.7</code></td></tr>
<tr><td>dotCover JSON export fails</td><td>dotCover 2025.3.0+ bug</td><td>Uninstall and install 2025.1.7</td></tr>
<tr><td><code>gh</code> not found</td><td>GitHub CLI not installed</td><td><code>winget install GitHub.cli</code></td></tr>
<tr><td><code>gh auth login</code> hangs</td><td>Running inside agent terminal</td><td>Run in separate PowerShell 7 window</td></tr>
<tr><td>CRLF/LF diffs everywhere</td><td><code>core.autocrlf</code> not set</td><td><code>git config --global core.autocrlf true</code></td></tr>
<tr><td><code>TestRunner.exe</code> missing</td><td>Build not run</td><td><code>.\ai\Build-Skyline.ps1</code></td></tr>
<tr><td>LabKey MCP tools not available</td><td>MCP server not registered</td><td>Run <code>claude mcp add labkey -- python &lt;path&gt;/server.py</code></td></tr>
<tr><td>LabKey authentication fails</td><td>Missing or incorrect <code>.netrc</code></td><td>Create <code>.netrc</code> with shared agent credentials</td></tr>
</table>

<h2>6. Resources</h2>

<ul>
<li><strong>Public developer setup guide</strong>: <a href="wiki-page.view?name=HowToBuildSkylineTip">How to Build Skyline</a></li>
<li><strong>LLM tooling docs</strong>: <code>ai/docs/build-and-test-guide.md</code></li>
<li><strong>Documentation maintenance system</strong>: <code>ai/docs/documentation-maintenance.md</code></li>
<li><strong>Claude Code documentation</strong>: <a href="https://code.claude.com/docs">code.claude.com/docs</a></li>
</ul>

<h2>7. Feedback</h2>

<p>If you discover additional steps that improve the human + LLM workflow, update this document and the public site. Consistency between the two keeps every developer productive.</p>

<p><i>Last updated:</i> 2025-12-17</p>
</body>
</html>
